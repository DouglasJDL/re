<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tarjeta Navide√±a Corporativa 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #c41e3a;
            --secondary: #2c5f2d;
            --gold: #d4af37;
            --pine: #0a2e1f;
            --cream: #ffffff;
        }

        html, body { 
            height: 100%; width: 100%; margin: 0; padding: 0; 
            background-color: #000;
        }

        body { box-sizing: border-box; font-family: 'Montserrat', sans-serif; overflow: hidden; }

        .app-wrapper { 
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
            width: 100%; height: 100%; overflow: hidden; 
        }

        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; 
            justify-content: center;
            padding: 1rem; box-sizing: border-box; 
            overflow-x: hidden; 
            overflow-y: auto;
        }

        .screen.scroll-ready {
            justify-content: flex-start;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        .screen.active { display: flex; z-index: 10; animation: fadeIn 0.8s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(1.02); } to { opacity: 1; transform: scale(1); } }

        .snowflake { position: fixed; top: -10px; color: white; pointer-events: none; z-index: 9999; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

        .welcome-screen { background: linear-gradient(135deg, #8b1538 0%, #c41e3a 50%, #d4af37 100%) !important; }
        .journey-screen { background: linear-gradient(135deg, #2c5f2d 0%, #1a3d1b 100%) !important; }
        .message-screen { background: linear-gradient(135deg, #8b1538 0%, #c41e3a 50%, #d4af37 100%) !important; }
        .envelope-screen { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important; }
        .final-screen { background: linear-gradient(135deg, #0a2e1f 0%, #165a34 50%, #2c5f2d 100%) !important; }

        .star { position: absolute; pointer-events: none; animation: twinkle 2s infinite; z-index: 1; }
        @keyframes twinkle { 0%, 100% { opacity: 0.8; transform: scale(1); } 50% { opacity: 0.2; transform: scale(1.2); } }

        .btn-main {
            background: linear-gradient(135deg, var(--primary) 0%, #8b0000 100%);
            color: white; padding: 0.8rem 1.5rem; border-radius: 50px; font-weight: 600;
            border: 2px solid var(--gold); cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.4); display: flex; align-items: center; justify-content: center; gap: 8px;
            width: auto;
        }

        .welcome-content {
            text-align: center; width: 95%; max-width: 420px; background: rgba(255, 255, 255, 0.98);
            padding: 2rem 1.2rem; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 4px solid var(--gold); z-index: 20;
        }

        .name-input { 
            width: 100%; padding: 0.8rem; border: 2px solid #ddd; border-radius: 12px; 
            margin-bottom: 0.5rem; text-align: center; font-size: 1rem; outline: none;
        }

        .magic-star-container {
            width: clamp(100px, 25vw, 180px); height: clamp(100px, 25vw, 180px); 
            position: relative; cursor: pointer; z-index: 20;
            filter: drop-shadow(0 0 20px var(--gold));
            display: flex; align-items: center; justify-content: center;
        }
        .magic-star { font-size: clamp(70px, 18vw, 110px); animation: starPulse 2s ease-in-out infinite; user-select: none; }
        @keyframes starPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(10deg); }
        }
        .magic-star-active { animation: starExplode 1.2s forwards !important; }
        @keyframes starExplode {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(8); opacity: 0; filter: blur(40px); }
        }

        .baubles-container { 
            display: flex; flex-wrap: wrap; justify-content: center; 
            gap: 12px; width: 100%; max-width: 550px; z-index: 50; position: relative; 
            padding: 10px;
        }
        .bauble { width: clamp(55px, 16vw, 75px); cursor: pointer; position: relative; z-index: 60; transform-origin: top center; animation: swing 4s ease-in-out infinite; }
        .bauble-string { width: 1px; height: 25px; background: rgba(255,255,255,0.3); margin: 0 auto; }
        .bauble-cap { width: 12px; height: 6px; background: var(--gold); border-radius: 1px; margin: -1px auto 0; }
        .bauble-body { 
            width: 100%; aspect-ratio: 1/1; border-radius: 50%; position: relative; 
            box-shadow: inset -4px -4px 8px rgba(0,0,0,0.3), inset 4px 4px 8px rgba(255,255,255,0.2), 0 4px 10px rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center; font-size: clamp(1rem, 4vw, 1.8rem);
        }
        
        .bauble.popped { animation: shatter 0.6s forwards; pointer-events: none; }
        @keyframes shatter { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; filter: blur(10px); } }

        #balloonModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92); z-index: 1000; display: none;
            align-items: center; justify-content: center; backdrop-filter: blur(8px);
            padding: 1rem;
        }
        #balloonModal.active { display: flex; }
        .modal-content {
            background: white; padding: 2rem 1.5rem; border-radius: 20px; text-align: center;
            width: 100%; max-width: 340px; border: 4px solid var(--gold);
        }

        .envelope-container { width: clamp(220px, 75vw, 280px); height: clamp(150px, 45vw, 180px); perspective: 1000px; z-index: 20; position: relative; cursor: pointer; }
        .envelope-back { width: 100%; height: 100%; background: #8b1538; border-radius: 5px; position: absolute; z-index: 1; border: 2px solid var(--gold); }
        .envelope-letter { 
            position: absolute; top: 10px; left: 5%; width: 90%; height: 85%; 
            background: #fff9e6; z-index: 2; transition: transform 0.8s ease-in-out, opacity 0.5s; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; border: 1px solid var(--gold); padding: 8px; opacity: 0;
        }
        .envelope-container.opened .envelope-letter { transform: translateY(-55%); z-index: 5; opacity: 1; }

        .final-card-wrapper { 
            width: 92%; max-width: 480px; position: relative; padding: 10px; z-index: 20; 
            margin: 20px auto; 
        }
        .pine-border {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            border: clamp(8px, 2vw, 12px) solid var(--pine); 
            border-radius: 20px; pointer-events: none;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 0 15px rgba(0,0,0,0.3);
            background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(0,0,0,0.1) 5px, rgba(0,0,0,0.1) 10px); z-index: 5;
        }
        .final-card { 
            background: #fffef7; padding: 1.5rem 1rem; border-radius: 12px; text-align: center; border: 2px solid var(--gold); 
            position: relative; z-index: 10; 
        }

        .audio-toggle {
            position: fixed; top: 12px; right: 12px; z-index: 100;
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.3);
            color: white; width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            font-size: 12px;
        }

        /* DISE√ëO PDF PREMIUM ADAPTATIVO CON TEXTURA DE PINO */
        #pdfCapture {
            position: absolute; left: -9999px; top: -9999px; width: 800px;
            background-color: #ffffff; box-sizing: border-box; padding: 0;
            display: flex; flex-direction: column; color: #222; overflow: hidden;
            min-height: 1131px;
        }

        /* Capa de textura de pino realista */
        .pdf-pine-frame {
            position: absolute; inset: 0; border: 35px solid var(--pine);
            z-index: 1; pointer-events: none;
            /* Textura simulando agujas de pino */
            background-image: 
                repeating-linear-gradient(45deg, #1b4d3e 0%, #0a2e1f 2px, transparent 2px, transparent 4px),
                repeating-linear-gradient(-45deg, #1b4d3e 0%, #0a2e1f 2px, transparent 2px, transparent 4px),
                linear-gradient(to bottom, #0a2e1f, #1b4d3e);
            background-blend-mode: overlay;
        }

        /* Capa de doble marco dorado respetada por el contenido */
        .pdf-gold-inner-frame {
            position: absolute; 
            top: 40px; left: 40px; right: 40px; bottom: 40px; 
            border: 6px double var(--gold);
            background: #ffffff; z-index: 2;
        }

        /* Trama de nieve de fondo sutil */
        .pdf-snow-overlay {
            position: absolute; 
            top: 45px; left: 45px; right: 45px; bottom: 45px;
            opacity: 0.12; z-index: 3; pointer-events: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="20" cy="20" r="1.5" fill="%23d4af37"/><circle cx="50" cy="80" r="2" fill="%23d4af37"/><circle cx="80" cy="30" r="1.2" fill="%23d4af37"/><circle cx="10" cy="60" r="1" fill="%23d4af37"/></svg>');
        }

        .pdf-content-area {
            position: relative; z-index: 10; 
            padding: 85px 90px; /* Padding extra para asegurar que nada toque los marcos */
            display: flex; flex-direction: column; flex-grow: 1;
        }

        .pdf-header-premium {
            display: flex; justify-content: space-between; align-items: flex-end;
            border-bottom: 2px solid var(--gold); padding-bottom: 20px; margin-bottom: 30px;
        }

        .pdf-wish-grid-premium {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 35px;
        }

        .pdf-wish-item {
            background: #fff; border: 1px solid #f2f2f2; padding: 15px; border-radius: 12px;
            border-left: 5px solid var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.02);
            text-align: justify;
        }

        .pdf-main-letter {
            background: #ffffff; border: 1px solid #f8f8f8; padding: 40px; border-radius: 15px;
            flex-grow: 1; display: flex; flex-direction: column; position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.03); border-top: 10px solid var(--pine);
        }
    </style>
</head>
<body>

<div class="audio-toggle" id="audioToggle">üîá</div>

<div class="app-wrapper" id="mainWrapper">
    <!-- Pantallas UI de la App -->
    <div class="screen welcome-screen active" id="welcomeScreen">
        <div class="text-5xl mb-6 relative z-20">üéÑ</div>
        <div class="welcome-content">
            <h1 class="text-2xl font-bold text-red-700 mb-3 font-serif uppercase tracking-tight">Navidad 2025</h1>
            <p class="text-gray-700 mb-5 text-sm font-medium">Ingresa tu nombre para iniciar esta experiencia m√°gica.</p>
            <input type="text" id="nameInput" class="name-input" placeholder="Tu nombre aqu√≠">
            <p id="errorMessage" class="text-red-600 text-[10px] mb-3 h-4"></p>
            <button id="continueBtn" class="btn-main text-sm">Comenzar ‚ú®</button>
        </div>
    </div>

    <div class="screen journey-screen" id="journeyScreen">
        <div class="magic-star-container" id="magicStarBtn">
            <div class="magic-star">‚≠ê</div>
        </div>
        <p class="text-white text-base mt-8 font-bold animate-pulse text-center relative z-20 px-6">
            Toca la Estrella para <br>iluminar tu camino al 2026 üåü
        </p>
    </div>

    <div class="screen message-screen" id="balloonsScreen">
        <h2 class="text-white text-lg font-bold mb-4 font-serif relative z-20 text-center px-4 uppercase tracking-wider">Deseos para ti üéÑ</h2>
        <p id="balloonsCounter" class="bg-black/30 text-white text-[9px] px-3 py-1 rounded-full mb-8 backdrop-blur-sm relative z-20">0/6 esferas descubiertas</p>
        <div class="baubles-container" id="balloonsContainer"></div>
    </div>

    <div class="screen envelope-screen" id="envelopeScreen">
        <div class="envelope-container" id="envelopeContainer">
            <div class="envelope-back"></div>
            <div class="envelope-letter">
                <div class="mb-1">
                    <p class="text-red-700 font-bold text-[10px] uppercase tracking-widest font-serif">Comunicado Especial</p>
                    <p class="text-gray-400 text-[7px] mt-0.5 italic">Corporaci√≥n Avanza</p>
                </div>
                <button id="readLetterBtn" class="hidden mt-1 bg-red-700 text-white text-[8px] px-3 py-1.5 rounded-full font-bold shadow-lg">
                    LEER CARTA ‚ú®
                </button>
            </div>
            <div class="envelope-front"></div>
            <div class="envelope-flap"></div>
        </div>
        <p id="envelopeHint" class="text-white text-sm mt-10 font-semibold relative z-20">Toca para abrir üíå</p>
    </div>

    <div class="screen final-screen scroll-ready" id="finalScreen">
        <div class="final-card-wrapper">
            <div class="pine-border"></div>
            <div id="lightsWrapper"></div>
            <div class="final-card">
                <h1 class="font-bold text-red-700 mb-3 font-serif uppercase tracking-tight">¬°Feliz Navidad!</h1>
                <p id="finalMessage" class="text-gray-800 leading-relaxed mb-4 text-justify"></p>
                <div class="mt-2 border-t border-dashed border-gray-300 pt-3">
                    <div class="signature-name mb-1">Daniel Marroqu√≠n</div>
                    <div class="text-[9px] uppercase tracking-widest text-gray-500 font-bold">Gerente General</div>
                    <div class="text-[8px] text-gray-400">Corporaci√≥n Avanza</div>
                </div>
                <div class="flex flex-col gap-2 justify-center mt-5 relative z-30">
                    <button id="shareBtn" class="btn-main text-[11px] w-full"><span>üì≤ Compartir Recuerdo</span></button>
                    <button id="downloadBtn" class="text-gray-500 text-[8px] font-bold hover:text-red-700 transition uppercase tracking-tighter">üìÑ Guardar PDF</button>
                    <button id="restartBtn" class="text-gray-400 text-[8px] hover:text-red-600 transition underline mt-1">üîÑ REINICIAR</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="balloonModal">
    <div class="modal-content">
        <div id="modalIcon" class="text-4xl mb-2"></div>
        <h3 id="modalTitle" class="text-base font-bold text-red-700 mb-1 font-serif uppercase"></h3>
        <p id="modalText" class="text-gray-600 text-xs italic mb-4 text-justify px-2"></p>
        <button id="modalCloseBtn" class="btn-main w-full py-2 text-xs">Descubrir ‚ú®</button>
    </div>
</div>

<!-- CAPTURA PDF REDISE√ëADA (GALA) -->
<div id="pdfCapture">
    <div class="pdf-pine-frame"></div>
    <div id="pdfBorderIcons" style="position:absolute; inset:0; z-index:2; pointer-events:none;"></div>
    <div class="pdf-gold-inner-frame"></div>
    <div class="pdf-snow-overlay"></div>
    
    <div class="pdf-content-area">
        <!-- Encabezado -->
        <div class="pdf-header-premium">
            <div style="flex: 1;">
                <h1 style="color: #c41e3a; font-size: 42px; font-family: 'Playfair Display', serif; margin: 0; line-height: 1;">Corporaci√≥n Avanza</h1>
                <p style="color: #1b4d3e; font-size: 15px; font-weight: 700; letter-spacing: 5px; margin-top: 5px; text-transform: uppercase;">Memoria de Gratitud 2025</p>
            </div>
            <div style="width: 140px; text-align: right;">
                <img id="pdfLogo" crossorigin="anonymous" style="max-height: 80px; width: auto; object-fit: contain;" alt="Logo">
            </div>
        </div>
        
        <div style="margin-bottom: 25px; text-align: center;">
            <p style="font-size: 18px; color: #555; font-family: 'Playfair Display', serif; font-style: italic; margin: 0;">Un obsequio de deseos especiales para:</p>
            <div style="margin-top: 10px; display: inline-block; position: relative;">
                <span id="pdfUserName" style="font-family: 'Playfair Display', serif; font-size: 34px; color: #c41e3a; font-weight: 700;"></span>
                <div style="width: 100%; height: 4px; background: linear-gradient(90deg, transparent, var(--gold) 50%, transparent); margin-top: 4px;"></div>
            </div>
        </div>

        <!-- Grid de Deseos Adaptativo -->
        <div id="pdfBalloonMessages" class="pdf-wish-grid-premium">
            <!-- Rellenado por JS -->
        </div>

        <!-- Carta Principal -->
        <div class="pdf-main-letter">
            <div style="position: absolute; top: 15px; right: 20px; font-size: 30px; opacity: 0.1;">üéÑ</div>
            <p id="pdfFinalMessage" style="line-height: 1.8; color: #222; font-size: 16px; white-space: pre-wrap; font-family: 'Montserrat', sans-serif; text-align: justify; margin-bottom: 30px;"></p>
            
            <div style="text-align: right; margin-top: auto; border-top: 1px solid #f0f0f0; padding-top: 20px;">
                <div style="font-family: 'Great Vibes', cursive; font-size: 42px; color: #111; margin-bottom: -5px;">Daniel Marroqu√≠n</div>
                <div style="font-size: 13px; color: #c41e3a; font-weight: 700; text-transform: uppercase; letter-spacing: 2px;">Gerente General</div>
                <div style="font-size: 11px; color: #999; margin-top: 3px;">Corporaci√≥n Avanza - Navidad 2025</div>
            </div>

            <!-- Footer Centrado Dentro de la Tarjeta Blanca -->
            <div style="text-align: center; font-size: 10px; color: #aaa; margin-top: 20px; letter-spacing: 2px; text-transform: uppercase; width: 100%;">Avanzando Juntos hacia el √âxito | ¬© 2025</div>
        </div>
    </div>
</div>

<script>
    const LOGO_BASE64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFE0lEQVR4nO2dW2hcVRSGv32SpplMmkmbZpImU9uYtNfWpkmbtNZWpUmttRREUEG8YIWI4oV6QXwQX/SBBx8E8UEffBAffPAuCIIXvCBeqCAIPggigggKgiB4QURBeX9On8XUJJm9z5yZfU6S+YPBpOfMnFmzn73P2mvvI0REQsh0WwMioT0SRiRkREJGJGREQkYkZERCRiRkREJGJGREQkYkZERCRiRkREJGJGREQkYkZERCRiRkREJGJGREQkYkZESivC8vH/T/RST9SBiRkBEJGZGQEQkZkZARCHG6DWA9rNq9p9u68GZkSBiRkBEJGZGQEQkZkZARCHG6DWA9pP3m2uO7u40pI0PCiISMSMiIhIxIyIiEiEiI020A6yHtM9fe6O42poxIyIiEjEjIiISMSMiIhIhIiNNtAOtj9Z695mYidvYwZWRIGJGQEQkZkZARCRmREBEJcboNYD1K49U+Sre7GZGRmREJGZGQEQkZkZARCRmREBEJcboNYD2kfebaY7u7jSlhREJGJGREQkYkZERCRiRE3i5X2/lF9pX7WkR8yF6mB4T8L0S8yK7Sj0Y8x7be10Y8YFv6oxGPWNb/I8RTluO9BvGUZbTjUojvLAs7LYT4yrK5vULI55YvVglZarntXCHke8v7u0PIFsuX64T8ZFl6tRDyp+VrFUK+szxrCSHfWV40hXxtWWsK+cqytS7kC8sTlpAvLEuuhHxh2XQp5HPL8pIhX1jWnhDyreVdS8jnlhcsIat27+u2LrwZEfG8vWIny8p9LSI+5A+7yU6GlftaRHxgO9lVlj+Y99mX/mREvMg+skfL+8wX2Z/7WUT8yH6mR8uXmHcyP2R/+lcR8SNXkz1ZPmQeSfevIuJF9pN9Wr7NfJBp/yoiXuRWssfKjzMnmW8y7X8VEW/ytN1mB8szzS/Zl9P+ZUS8yNPsyPKzTDp97V9GxIv8XpYfZZL/Z9r/WUT8yNN2jx0oTzOfZdp/VUT8yO8l3UqOlp9lkn+S5f8Yf5X/B8P769X6M+Yf9mXvKCKI7GZayf7yx0y69pZ7RhGR7GPayU6mlX+XSeWfSfpfEUESv5M9Uf6XSeaO7Lp7RhGR7GbaSveUqXQ/Sf9rIoLIXqaNfGf5X/pP0v+mCIL0XqZnyu8y7f8m/aeLCOI6v59pI//M9J/5vUwfH0XED3mdnyI9XKaP3M7v8FNE/JDX6ePlNf6I9Y+9Tv76KSJ+SOnVpCcpI6V7SOnno4j4IUfJIyX9iOnTpJ8uIuJHHiPPlf8j87j8K8ujioiY4zHyXPl98356Nf+uIuJH9pMHynPm3fS+8u9FRMQvj5BHy/Nm9pIHmI8tIsJ+UjrN08vHmEfIk0REIsqO5TnyPPMXpUPEhxwhT5bnmR6ZHyoiIn5LjpFny7PNtOnp9MsiIuL6I8vS5U/Nm+XfWf6jiAAsr5DnyXPN9Olly29FRMQfS8svlvX0GvO05asiIuL5P5X7Wv766WXL8/9UfioiAEvLfyovmNmb7FReMiIAr/8l96X8u9KLSy98N9NXRREBxPNmppXsz/wo82MmvVp6MERErPJXpgeZpOfXmZ6S7CgiAMtr5ZVMH7vO9C6mx5m+KooIIN5fL+nh8idJD5P0sKRHm9f9P/C36XmSXstfKT3KdLmZ9CjT9/O5/VFEJCK+fX2Wv99IeobpGUnXmf4b7X8YERGJ9E8zPT6f33+r/B9p/9f9VxFBRJxeZ3o908fX+f3yY/+H9v8TfwM5rGq9N8Y3+gAAAABJRU52Kam6";

    const categoryPhrases = {
        'üôè Gratitud': ["Gracias por tu entrega constante; eres el coraz√≥n de nuestro avance diario.", "Valoramos profundamente tu dedicaci√≥n este a√±o. Gracias por ser parte del equipo.", "Tu esfuerzo incansable es el motor que nos impulsa a llegar m√°s lejos.", "Gratitud eterna por cada hora de trabajo y cada meta alcanzada juntos.", "Eres una pieza invaluable en este rompecabezas de √©xito corporativo.", "Gracias por aportar tu talento y energ√≠a positiva en cada desaf√≠o del 2025.", "Tu compromiso nos llena de orgullo. Gracias por creer en nuestra visi√≥n.", "Reconocemos tu gran labor y agradecemos tu lealtad hacia la familia Avanza.", "Gracias por convertir cada obst√°culo en una oportunidad de crecimiento.", "Tu presencia hace la diferencia. Gracias por un a√±o de resultados brillantes."],
        '‚≠ê √âxito': ["Tus logros este a√±o son la base sobre la cual construiremos un 2026 √©pico.", "El √©xito no llega por casualidad, es el reflejo de tu brillante desempe√±o.", "Celebramos tus victorias individuales que fortalecen nuestra grandeza colectiva.", "Has demostrado que con pasi√≥n y estrategia, no hay meta inalcanzable.", "Tu excelencia profesional nos inspira a todos a buscar nuestra mejor versi√≥n.", "Eres sin√≥nimo de perseverancia y resultados. ¬°Felicidades por tus √©xitos!", "Tus metas cumplidas son los pelda√±os que nos llevan a la cima corporativa.", "Has brillado con luz propia este a√±o, iluminando el camino del equipo.", "El 2025 fue el a√±o donde demostraste que los l√≠mites solo est√°n en la mente.", "Que cada √©xito de este a√±o se multiplique en bendiciones para tu futuro."],
        'ü§ù Compromiso': ["Tu lealtad es nuestro activo m√°s valioso. Gracias por ponerte la camiseta.", "El compromiso que demuestras d√≠a a d√≠a es lo que nos hace una gran empresa.", "Tu pasi√≥n por lo que haces se refleja en la calidad de cada proyecto.", "Gracias por tu firmeza y por nunca rendirte ante las adversidades.", "Eres un ejemplo de integridad y entrega profesional para todos nosotros.", "Tu responsabilidad y √©tica de trabajo son pilares fundamentales de Avanza.", "Apreciamos tu disposici√≥n constante para ayudar y colaborar con el equipo.", "Tu entrega total nos permite mirar hacia el futuro con absoluta confianza.", "Gracias por ser esa persona con la que siempre podemos contar incondicionalmente.", "Tu fidelidad a nuestros valores corporativos nos fortalece como familia."],
        '‚ú® Unidad': ["Juntos somos m√°s fuertes. Gracias por fomentar el compa√±erismo y la uni√≥n.", "M√°s que un equipo de trabajo, somos una familia que crece apoy√°ndose.", "Tu capacidad para trabajar en equipo es lo que nos permite volar m√°s alto.", "La unidad que demuestras fortalece los lazos que nos mantienen creciendo.", "Gracias por ser el pegamento que mantiene unido y motivado a tu equipo.", "En la diversidad de nuestros talentos encontramos nuestra fuerza unida.", "Celebramos la armon√≠a y el respeto que aportas al ambiente laboral diario.", "Tu colaboraci√≥n desinteresada es la chispa que enciende nuestro motor.", "Unidos hemos superado tormentas y juntos llegaremos a nuevos puertos.", "Gracias por entender que el √©xito de uno es el orgullo de todos nosotros."],
        'üöÄ Futuro': ["El 2026 nos espera con grandes horizontes que conquistaremos de tu mano.", "Miramos hacia adelante con ilusi√≥n, sabiendo que contamos con tu talento.", "El futuro es brillante porque personas como t√∫ est√°n construyendo el hoy.", "Prep√°rate para un a√±o lleno de innovaci√≥n, retos y nuevas metas por cumplir.", "Sigamos avanzando juntos hacia un 2026 que promete ser nuestro mejor a√±o.", "Tu evoluci√≥n constante es la garant√≠a de nuestro √©xito en el futuro pr√≥ximo.", "Nuevas historias de √©xito est√°n esperando ser escritas por ti este nuevo a√±o.", "Confiamos plenamente en que el 2026 ser√° testigo de tu gran crecimiento.", "El ma√±ana se construye con el esfuerzo de hoy. ¬°Vamos con todo al 2026!", "Tu visi√≥n de futuro nos ayuda a anticipar los retos y ganar cada batalla."],
        '‚ù§Ô∏è Felicidad': ["Deseamos que la magia de la Navidad inunde cada rinc√≥n de tu hogar hoy.", "Que la paz y el amor sean los invitados de honor en tu mesa esta temporada.", "Tu alegr√≠a es contagiosa. Deseamos que seas inmensamente feliz estas fiestas.", "Que el descanso de fin de a√±o renueve tus fuerzas y alegre tu coraz√≥n.", "Deseamos que compartas momentos inolvidables con tus seres m√°s queridos.", "Que la armon√≠a familiar sea el regalo m√°s grande que recibas esta Navidad.", "Te deseamos salud, prosperidad y abundancia en cada d√≠a del a√±o venidero.", "Que la sonrisa de tus seres amados ilumine tu vida tanto como tu trabajo aqu√≠.", "Deseamos que estas fiestas te traigan la calma y felicidad que mereces.", "¬°Felices fiestas! Que el amor sea el norte que gu√≠e tus pasos en el 2026."]
    };

    const balloonCategories = [
        { icon: 'üôè', title: 'Gratitud', color: 'bg-red-600' },
        { icon: '‚≠ê', title: '√âxito', color: 'bg-yellow-500' },
        { icon: 'ü§ù', title: 'Compromiso', color: 'bg-green-600' },
        { icon: '‚ú®', title: 'Unidad', color: 'bg-blue-600' },
        { icon: 'üöÄ', title: 'Futuro', color: 'bg-purple-600' },
        { icon: '‚ù§Ô∏è', title: 'Felicidad', color: 'bg-pink-500' }
    ];

    let userName = "";
    let poppedCount = 0;
    let currentBaubleElement = null;
    let selectedPhrases = [];

    function toProperCase(str) { return str.replace(/\w\S*/g, t => t.charAt(0).toUpperCase() + t.substr(1).toLowerCase()); }
    function showScreen(id) { 
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active', 'scroll-ready')); 
        const target = document.getElementById(id);
        target.classList.add('active'); 
        if(id === 'finalScreen') target.classList.add('scroll-ready');
        target.scrollTop = 0;
    }

    function initSnow() {
        for(let i=0; i<30; i++) {
            let snow = document.createElement('div');
            snow.className = 'snowflake'; snow.innerHTML = '‚ùÑ';
            snow.style.left = Math.random() * 100 + 'vw';
            snow.style.animationDuration = (Math.random() * 3 + 3) + 's';
            snow.style.opacity = Math.random();
            snow.style.fontSize = Math.random() * 10 + 10 + 'px';
            document.body.appendChild(snow);
        }
    }

    function decoratePdfBorder() {
        const wrapper = document.getElementById('pdfBorderIcons');
        wrapper.innerHTML = '';
        const icons = ['üéÅ', 'üîî', '‚ú®', 'üéÄ', 'üéÖ', 'ü¶å'];
        const colors = ['#ff0000', '#ffff00', '#ffffff', '#00ff00', '#0000ff'];
        
        for(let i=0; i<40; i++) {
            const el = document.createElement('div');
            el.style.position = 'absolute'; el.style.zIndex = '5'; el.style.fontSize = '18px';
            const light = document.createElement('div');
            light.style.width = '10px'; light.style.height = '10px'; light.style.borderRadius = '50%';
            light.style.backgroundColor = colors[i % colors.length];
            light.style.boxShadow = `0 0 10px ${colors[i % colors.length]}`;
            light.style.position = 'absolute';

            if(i < 10) { 
                el.style.top = '6px'; el.style.left = (i * 10) + '%';
                el.innerText = i % 2 === 0 ? icons[i % icons.length] : '';
                light.style.top = '15px'; light.style.left = (i * 10 + 5) + '%';
            } else if(i < 20) { 
                el.style.top = ((i - 10) * 10) + '%'; el.style.right = '6px';
                el.innerText = i % 2 === 0 ? icons[i % icons.length] : '';
                light.style.top = ((i - 10) * 10 + 5) + '%'; light.style.right = '15px';
            } else if(i < 30) { 
                el.style.bottom = '6px'; el.style.right = ((i - 20) * 10) + '%';
                el.innerText = i % 2 === 0 ? icons[i % icons.length] : '';
                light.style.bottom = '15px'; light.style.right = ((i - 20) * 10 + 5) + '%';
            } else { 
                el.style.bottom = ((i - 30) * 10) + '%'; el.style.left = '6px';
                el.innerText = i % 2 === 0 ? icons[i % icons.length] : '';
                light.style.bottom = ((i - 30) * 10 + 5) + '%'; light.style.left = '15px';
            }
            wrapper.appendChild(el); wrapper.appendChild(light);
        }
    }

    function initBalloons() {
        const container = document.getElementById('balloonsContainer');
        container.innerHTML = '';
        selectedPhrases = [];
        balloonCategories.forEach((cat, index) => {
            const fullTitle = `${cat.icon} ${cat.title}`;
            const phrases = categoryPhrases[fullTitle];
            const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
            const b = document.createElement('div');
            b.className = 'bauble';
            b.style.animationDelay = (index * 0.4) + 's';
            b.innerHTML = `<div class="bauble-string"></div><div class="bauble-cap"></div><div class="bauble-body ${cat.color}">${cat.icon}</div>`;
            b.onclick = (e) => {
                e.stopPropagation();
                if(b.classList.contains('popped')) return;
                currentBaubleElement = b;
                document.getElementById('modalIcon').innerText = cat.icon;
                document.getElementById('modalTitle').innerText = cat.title;
                document.getElementById('modalText').innerText = randomPhrase;
                selectedPhrases.push({ icon: cat.icon, title: cat.title, text: randomPhrase });
                document.getElementById('balloonModal').classList.add('active');
            };
            container.appendChild(b);
        });
    }

    document.getElementById('modalCloseBtn').onclick = (e) => {
        e.stopPropagation();
        document.getElementById('balloonModal').classList.remove('active');
        if(currentBaubleElement) {
            if (navigator.vibrate) navigator.vibrate(30);
            currentBaubleElement.classList.add('popped');
            poppedCount++;
            document.getElementById('balloonsCounter').innerText = `${poppedCount}/6 esferas descubiertas`;
            currentBaubleElement = null;
            if(poppedCount === 6) setTimeout(() => showScreen('envelopeScreen'), 1100);
        }
    };

    function prepareCapture() {
        decoratePdfBorder();
        document.getElementById('pdfUserName').innerText = userName;
        document.getElementById('pdfFinalMessage').innerText = document.getElementById('finalMessage').innerText;
        const bCont = document.getElementById('pdfBalloonMessages');
        bCont.innerHTML = '';
        selectedPhrases.forEach(d => {
            bCont.innerHTML += `<div class="pdf-wish-item">
                <strong style="color: #c41e3a; font-size: 13px; font-family: 'Playfair Display', serif; text-transform: uppercase;">${d.icon} ${d.title}</strong>
                <span style="font-size: 11px; color: #444; line-height: 1.4;">${d.text}</span>
            </div>`;
        });
        document.getElementById('pdfLogo').src = LOGO_BASE64;
    }

    async function generateImageAndShare() {
        const btn = document.getElementById('shareBtn');
        btn.innerHTML = "‚è≥ Preparando...";
        prepareCapture();
        try {
            const canvas = await html2canvas(document.getElementById('pdfCapture'), { scale: 2, useCORS: true });
            canvas.toBlob(async (blob) => {
                const file = new File([blob], `Memoria_Navidena.png`, { type: 'image/png' });
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({ files: [file], title: '¬°Feliz Navidad!', text: 'Mi tarjeta de Corporaci√≥n Avanza' });
                } else {
                    const link = document.createElement('a'); link.download = `Navidad_Avanza.png`; link.href = canvas.toDataURL(); link.click();
                }
            });
        } catch (e) {} finally { btn.innerHTML = "üì≤ Compartir Recuerdo"; }
    }

    async function generatePDF() {
        const btn = document.getElementById('downloadBtn');
        btn.innerText = "‚è≥ Generando...";
        prepareCapture();
        try {
            const canvas = await html2canvas(document.getElementById('pdfCapture'), { scale: 2 });
            const img = canvas.toDataURL('image/png');
            const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
            const pW = pdf.internal.pageSize.getWidth();
            const pH = (canvas.height * pW) / canvas.width;
            pdf.addImage(img, 'PNG', 0, 0, pW, Math.min(pH, pdf.internal.pageSize.getHeight()));
            pdf.save(`Carta_Navidad_${userName}.pdf`);
        } catch (e) {} finally { btn.innerText = "üìÑ GUARDAR PDF"; }
    }

    document.getElementById('continueBtn').onclick = () => {
        const i = document.getElementById('nameInput');
        if(!i.value.trim()) { i.style.borderColor = "red"; return; }
        userName = toProperCase(i.value.trim());
        showScreen('journeyScreen');
    };

    document.getElementById('magicStarBtn').onclick = function() {
        this.classList.add('magic-star-active');
        setTimeout(() => showScreen('balloonsScreen'), 1100);
    };

    document.getElementById('envelopeContainer').onclick = function() {
        if(this.classList.contains('opened')) return;
        this.classList.add('opened');
        document.getElementById('envelopeHint').classList.add('hidden');
        setTimeout(() => { document.getElementById('readLetterBtn').classList.remove('hidden'); }, 650);
    };

    document.getElementById('readLetterBtn').onclick = (e) => {
        e.stopPropagation();
        document.getElementById('finalMessage').innerText = `Apreciado/a ${userName},\n\nEres una pieza clave e invaluable en Corporaci√≥n Avanza. Cerramos este 2025 con gratitud por tu esfuerzo incansable y dedicaci√≥n diaria.\n\nQue esta Navidad te brinde descanso y alegr√≠a junto a tus seres queridos, y que el 2026 nos permita seguir escribiendo juntos nuevas historias de √©xito.\n\n¬°Felices fiestas!`;
        showScreen('finalScreen');
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#c41e3a', '#d4af37'] });
    };

    document.getElementById('restartBtn').onclick = () => location.reload();
    document.getElementById('downloadBtn').onclick = generatePDF;
    document.getElementById('shareBtn').onclick = generateImageAndShare;

    window.onload = () => {
        initSnow(); initBalloons();
        const p = new URLSearchParams(window.location.search);
        const n = p.get('nombre') || p.get('name');
        if(n) { userName = toProperCase(decodeURIComponent(n)); showScreen('journeyScreen'); }
    };
</script>

</body>
</html>